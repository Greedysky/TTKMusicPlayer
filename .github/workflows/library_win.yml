# Author: Greedysky <greedysky@163.com>

name: library_win

on: workflow_call

jobs:
  build:
    name: Build on mingw
    strategy:
      matrix:
        version: [492, 530, 730, 810, 1120, 1310]
        arch: [32, 64]
        os: [windows-2022]
        include:
          - arch: 32
            target: x86
          - arch: 64
            target: x64
        exclude:
          - version: 492
            arch: 64
          - version: 530
            arch: 64
          - version: 1120
            arch: 32
          - version: 1310
            arch: 32

    env:
      WIN_MINGW_PATH: D:/a/TTKMusicPlayer/mingw/bin
      WIN_INSTALL_PATH: D:/a/TTKMusicPlayer/install/gcc
      UNIX_MINGW_PATH: /d/a/TTKMusicPlayer/mingw/bin
      UNIX_MINGW_OPT_PATH: /d/a/TTKMusicPlayer/mingw/opt
      UNIX_INSTALL_PATH: /d/a/TTKMusicPlayer/install/gcc

    runs-on: ${{matrix.os}}
    steps:
      - name: Install MSYS2
        uses: msys2/setup-msys2@v2
        with:
          msystem: mingw${{matrix.arch}}
          update: true
          install: >-
            p7zip
            libtool
            make
            texinfo
            autoconf
            automake
            pkg-config

      - name: Install MinGW${{matrix.version}}_${{matrix.arch}}
        run: |
          curl -L https://github.com/Greedysky/Resource/releases/download/1.0.0.0/mingw${{matrix.version}}_${{matrix.arch}}.7z -o mingw.7z
          7z x mingw.7z -omingw
          # remove default installed mingw64
          mv C:\mingw64 C:\mingw64_useless
          # set environment variable
          echo "${{env.WIN_MINGW_PATH}};" >> $env:GITHUB_PATH
        working-directory: ${{runner.workspace}}

      - name: Install thirdParty dependencies
        run: |
          curl -L https://github.com/Greedysky/TTKMusicPlayer/releases/download/continuous-build/qmmp-extra-pkg.7z -o qmmp-extra-pkg.7z
          7z x qmmp-extra-pkg.7z
        working-directory: ${{runner.workspace}}

      - name: Build library for libadlmidi
        run: |
          7z x libADLMIDI-1.6.1.7z -olibadlmidi
          cd libadlmidi
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libadlmidi -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DUSE_NUKED_EMULATOR=OFF -DUSE_OPAL_EMULATOR=OFF -DUSE_JAVA_EMULATOR=OFF -DUSE_ESFMU_EMULATOR=OFF -DUSE_MAME_EMULATOR=OFF -DUSE_YMFM_EMULATOR=OFF
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libbinio
        shell: msys2 {0}
        run: |
          7z x libbinio-1.5.7z -olibbinio
          cd libbinio
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          autoreconf --install
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libadplug CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --enable-maintainer-mode
          make -j2 && make install
          find ${{env.UNIX_INSTALL_PATH}}/libadplug -type f -name "*.la" -exec rm {} +
        working-directory: ${{runner.workspace}}

      - name: Build library for libadplug
        shell: msys2 {0}
        run: |
          7z x adplug-2.4.7z -olibadplug
          cd libadplug
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          export PKG_CONFIG_PATH=${{env.UNIX_INSTALL_PATH}}/libadplug/lib/pkgconfig:$PKG_CONFIG_PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libadplug CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libsndfile
        run: |
          7z x libsndfile-1.2.2.7z -olibsndfile
          cd libsndfile
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libsndfile -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libbs2b
        shell: msys2 {0}
        run: |
          7z x libbs2b-3.1.0.7z -olibbs2b
          cd libbs2b
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          export PKG_CONFIG_PATH=${{env.UNIX_INSTALL_PATH}}/libsndfile/lib/pkgconfig:$PKG_CONFIG_PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libbs2b CFLAGS="-O3" CXXFLAGS="-O3" --enable-static CPPFLAGS="-I${{env.UNIX_INSTALL_PATH}}/libsndfile/include" LDFLAGS="-L${{env.UNIX_INSTALL_PATH}}/libsndfile/lib -lm"
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libcddb
        shell: msys2 {0}
        run: |
          7z x libcddb-1.3.2.7z -olibcddb
          cd libcddb
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libcddb CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --without-cdio
          # fix build for regex
          echo "#define HAVE_REGEX_H 1" >> config.h
          cp ${{env.UNIX_MINGW_OPT_PATH}}/include/regex.h include/cddb
          mkdir -p lib/.libs
          cp ${{env.UNIX_MINGW_OPT_PATH}}/lib/libregex.a lib/.libs
          make -j2 && make install
          # fix install library
          cp ${{env.UNIX_MINGW_OPT_PATH}}/lib/libregex.a ${{env.UNIX_INSTALL_PATH}}/libcddb/lib
        working-directory: ${{runner.workspace}}

      - name: Build library for libcdio
        shell: msys2 {0}
        run: |
          7z x libcdio-2.1.0.7z -olibcdio
          cd libcdio
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./autogen.sh
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libcdio CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --disable-cxx --disable-example-progs --disable-cddb --without-cd-drive --without-cd-info --without-cdda-player --without-iso-info --without-iso-read --without-cd-read
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libcdio-paranoia
        shell: msys2 {0}
        run: |
          7z x libcdio-paranoia-10.2+2.0.1.7z -olibcdio-paranoia
          cd libcdio-paranoia
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          export PKG_CONFIG_PATH=${{env.UNIX_INSTALL_PATH}}/libcdio/lib/pkgconfig:$PKG_CONFIG_PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libcdio CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --disable-cxx --disable-example-progs
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libenca
        shell: msys2 {0}
        run: |
          7z x enca-1.21.7z -olibenca
          cd libenca
          # remove build for bin and test
          sed -i "198s/=.*/= lib/g" Makefile.in
          sed -i "401s/=.*/= lib/g" Makefile.in
          sed -i "402s/=.*/= lib/g" Makefile.in
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libenca CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libfaad2
        run: |
          7z x faad2-2.11.2.7z -olibfaad2
          cd libfaad2
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libfaad2 -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libspeex
        shell: msys2 {0}
        run: |
          7z x speex-1.2.1.7z -olibspeex
          cd libspeex
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./autogen.sh
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libspeex CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libffmpeg
        shell: msys2 {0}
        run: |
          7z x ffmpeg-3.4.14.7z -olibffmpeg
          cd libffmpeg
          # fix operand type mismatch for `shr'
          curl -L https://raw.githubusercontent.com/FFmpeg/FFmpeg/refs/heads/master/libavcodec/x86/mathops.h -o libavcodec/x86/mathops.h
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          export PKG_CONFIG_PATH=${{env.UNIX_INSTALL_PATH}}/libspeex/lib/pkgconfig:$PKG_CONFIG_PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libffmpeg --enable-shared --disable-static --disable-debug --disable-doc --disable-avdevice --disable-x86asm --disable-network --disable-encoders --disable-indevs --disable-outdevs --disable-iconv --disable-bsfs --disable-programs --disable-d3d11va --disable-dxva2 --disable-muxers --disable-parsers --disable-filters --disable-decoders --enable-decoder=wmav1 --enable-decoder=wmav2 --enable-decoder=ape --enable-decoder=tta --enable-decoder=aac --enable-decoder=alac --enable-decoder=ra_144 --enable-decoder=ra_288 --enable-decoder=shorten --enable-decoder=eac3 --enable-decoder=dca --enable-decoder=truehd --enable-decoder=twinvq --enable-decoder=tak --enable-decoder=adpcm_adx --enable-decoder=pcm_alaw --enable-decoder=pcm_s16be --enable-decoder=pcm_s16le --enable-decoder=gsm --enable-decoder=amrnb --enable-decoder=amrwb --enable-decoder=opus --enable-decoder=ac3 --enable-decoder=mp2 --enable-decoder=mp3 --enable-decoder=dsd_lsbf --enable-decoder=dsd_msbf --enable-decoder=vorbis --enable-decoder=flac --enable-decoder=libspeex --enable-libspeex --extra-cflags="-O3" --extra-cxxflags="-O3"
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libogg
        shell: msys2 {0}
        run: |
          7z x libogg-1.3.6.7z -olibogg
          cd libogg
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libogg CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libflac
        run: |
          7z x flac-1.5.0.7z -olibflac
          cd libflac
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libflac -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DENABLE_64_BIT_WORDS=OFF -DENABLE_MULTITHREADING=OFF -DWITH_FORTIFY_SOURCE=OFF -DWITH_STACK_PROTECTOR=OFF -D_OGG_INCLUDE_DIRS=${{env.WIN_INSTALL_PATH}}/libogg/include -D_OGG_LIBRARY_DIRS=${{env.WIN_INSTALL_PATH}}/libogg/lib
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libgme
        run: |
          7z x libgme-0.6.4.7z -olibgme
          cd libgme
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libgme -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DBUILD_SHARED_LIBS=OFF
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libmpcdec
        run: |
          7z x libmpcdec_r475.7z -olibmpcdec
          cd libmpcdec
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libmpcdec -DCMAKE_C_FLAGS="-O3" -DSHARED=OFF
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libmpg123
        shell: msys2 {0}
        run: |
          7z x mpg123-1.33.4.7z -olibmpg123
          cd libmpg123
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libmpg123 CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libopenmpt
        shell: msys2 {0}
        run: |
          7z x libopenmpt-0.4.52.7z -olibopenmpt
          cd libopenmpt
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libopenmpt CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --without-zlib --without-mpg123 --without-ogg --without-vorbis --without-vorbisfile --without-pulseaudio --without-portaudio --without-portaudiocpp --without-sndfile --without-flac
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for liboptimfrog
        shell: msys2 {0}
        run: |
          7z x OptimFROG_5100.7z -oliboptimfrog
          cd liboptimfrog/win${{matrix.arch}}/SDK
          mkdir -p liboptimfrog/include
          mv Library liboptimfrog/lib && mv OptimFROG liboptimfrog/include
          mkdir -p liboptimfrog/bin
          mv liboptimfrog/lib/OptimFROG.dll liboptimfrog/bin/libOptimFROG.dll
          mv liboptimfrog ${{env.UNIX_INSTALL_PATH}}/liboptimfrog
        working-directory: ${{runner.workspace}}

      - name: Build library for libopus
        shell: msys2 {0}
        run: |
          7z x opus-1.6.1.7z -olibopus
          cd libopus
          if [ ${{matrix.version}} -lt 1310 ]; then
            # add opus missing ssp library patch
            # see https://github.com/msys2/MINGW-packages/issues/8240
            # sed -i 's/Libs.private.*/& -lssp/' opus.pc.in
            sed -i 's/libopus_la_LDFLAGS =.*/& -lssp/' Makefile.in
          fi
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libopusfile CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --disable-extra-programs
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libopusfile
        shell: msys2 {0}
        run: |
          7z x opusfile-0.12.7z -olibopusfile
          cd libopusfile
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          export PKG_CONFIG_PATH=${{env.UNIX_INSTALL_PATH}}/libogg/lib/pkgconfig:${{env.UNIX_INSTALL_PATH}}/libopusfile/lib/pkgconfig:$PKG_CONFIG_PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libopusfile CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --disable-http --disable-doc
          make -j2 && make install
          # add opus header patch
          sed -i "s/<opus_/<opus\/opus_/g" ${{env.UNIX_INSTALL_PATH}}/libopusfile/include/opus/opusfile.h
        working-directory: ${{runner.workspace}}

#      - name: Build library for glew
#        run: |
#          curl -L https://downloads.sourceforge.net/sourceforge/glew/glew/2.2.0/glew-2.2.0.zip -o glew.zip
#          7z x glew.zip
#          cd glew-2.2.0
#          cmake build/cmake -G "Unix Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libprojectm -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DBUILD_UTILS=OFF
#          mingw32-make -j2
#          # fix missing install library
#          mkdir ${{env.WIN_INSTALL_PATH}}/libprojectm
#          mv bin ${{env.WIN_INSTALL_PATH}}/libprojectm
#          mv include ${{env.WIN_INSTALL_PATH}}/libprojectm
#          mv lib ${{env.WIN_INSTALL_PATH}}/libprojectm
#        working-directory: ${{runner.workspace}}

      - name: Build library for libprojectm
        shell: msys2 {0}
        run: |
          7z x libprojectm-2.2.1.7z -olibprojectm
          cd libprojectm
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./autogen.sh
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libprojectm CFLAGS="-O3 -DDISABLE_NATIVE_PRESETS" CXXFLAGS="-O3 -DDISABLE_NATIVE_PRESETS" LDFLAGS="-L. -lopengl32" --enable-static --disable-shared
          make -j2 && make install
          # fix install headers
          mkdir ${{env.UNIX_INSTALL_PATH}}/libprojectm/include/libprojectM
          mv src/libprojectM/win32-dirent.h ${{env.UNIX_INSTALL_PATH}}/libprojectm/include/libprojectM
          mv ${{env.UNIX_INSTALL_PATH}}/libprojectm/include/*.h* ${{env.UNIX_INSTALL_PATH}}/libprojectm/include/libprojectM
        working-directory: ${{runner.workspace}}

      - name: Build library for libsamplerate
        run: |
          7z x libsamplerate-0.2.2.7z -olibsamplerate
          cd libsamplerate
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libsamplerate -DCMAKE_C_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libsidplayfp
        shell: msys2 {0}
        run: |
          7z x libsidplayfp-2.3.1.patch.7z -olibsidplayfp
          cd libsidplayfp
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libsidplayfp CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libsoxr
        run: |
          7z x soxr-0.1.3.7z -olibsoxr
          cd libsoxr
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libsoxr -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DWITH_OPENMP=OFF -DBUILD_SHARED_LIBS=OFF
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libtaglib
        run: |
          7z x taglib-1.13.1.7z -olibtaglib
          cd libtaglib
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libtaglib -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3" -DWITH_ZLIB=OFF
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libvorbis
        run: |
          7z x libvorbis-1.3.7.7z -olibvorbis
          cd libvorbis
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libvorbis -DCMAKE_PREFIX_PATH=${{env.WIN_INSTALL_PATH}}/libogg -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libwavpack
        run: |
          7z x wavpack-5.9.0.7z -olibwavpack
          cd libwavpack
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libwavpack -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libxmp
        shell: msys2 {0}
        run: |
          7z x libxmp-4.7.0-patch.7z -olibxmp
          cd libxmp
          export PATH=${{env.UNIX_MINGW_PATH}}:$PATH
          ./configure --prefix=${{env.UNIX_INSTALL_PATH}}/libxmp CFLAGS="-O3" CXXFLAGS="-O3" --enable-static --disable-shared --disable-depackers --disable-prowizard
          make -j2 && make install
        working-directory: ${{runner.workspace}}

      - name: Build library for libsunvox
        run: |
          7z x sunvox-2.1.4.7z -olibsunvox
          cd libsunvox
          mkdir ${{env.WIN_INSTALL_PATH}}/libsunvox
          mv windows/${{matrix.target}}/sunvox.dll ${{env.WIN_INSTALL_PATH}}/libsunvox
        working-directory: ${{runner.workspace}}

      - name: Build library for libttk
        run: |
          7z x ttk-1.2.12.7z -olibttk
          cd libttk
          mkdir build && cd build
          cmake .. -G "MinGW Makefiles" -DCMAKE_BUILD_TYPE=Release -DCMAKE_INSTALL_PREFIX=${{env.WIN_INSTALL_PATH}}/libttk -DCMAKE_C_FLAGS="-O3" -DCMAKE_CXX_FLAGS="-O3"
          mingw32-make -j2 && mingw32-make install
        working-directory: ${{runner.workspace}}

      - name: Build thirdParty libraries package
        run: |
          # add portable binary package
          7z a thirdParty-libraries-win-mingw${{matrix.version}}-${{matrix.target}}.7z
        working-directory: ${{runner.workspace}}/install

      - name: Archive artifacts
        uses: softprops/action-gh-release@v2
        with:
          tag_name: continuous-build
          token: ${{secrets.GITHUB_TOKEN}}
          generate_release_notes: false
          files: ${{runner.workspace}}/install/thirdParty-libraries-win-mingw${{matrix.version}}-${{matrix.target}}.7z
